{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>회원가입</title>
  <link rel="stylesheet" href="{% static 'uauth/css/signup.css' %}">
</head>
<body>
  <header class="page" aria-labelledby="pagetitle">
    <h1 id="pagetitle">회원가입</h1>
    <p>회원가입을 위한 정보를 입력해주세요</p>
  </header>

  <main class="card" role="main" aria-labelledby="sectionTitle">
    <div class="section-desc">아래 정보를 입력하여 회원가입을 완료해주세요.</div>

    <form id="registerForm" class="form" method="post" action="{% url 'uauth:signup' %}" novalidate enctype="multipart/form-data">
      {% csrf_token %}

      {# 추가: 전체(non-field) 에러 표시 #}
      {% if form and form.non_field_errors %}
        <div class="error nonfield">
          {% for err in form.non_field_errors %}<p>{{ err }}</p>{% endfor %}
        </div>
      {% endif %}
      <div class="grid">
        <div class="form-item full profile-row">
          <label for="profile_image">프로필 이미지</label>

          <div class="profile-flex">
            <!-- 왼쪽: 미리보기 -->
            <div class="avatar-preview">
              <img id="profilePreview" alt="프로필 미리보기" style="display:none;">
            </div>

            <!-- 오른쪽: 파일 선택 -->
            <div class="file-input">
              <input id="profile_image" name="profile_image" type="file" accept="image/*" aria-describedby="profileImageErr">
              <div id="profileImageErr" class="error"></div>
            </div>
          </div> 
        </div> 
   
        <!-- 아이디 -->
        <div class="form-item">
          <label for="userId">아이디</label>
          <input id="userId" name="userId" type="text" placeholder="아이디를 입력하세요"
                 required minlength="4" maxlength="20"
                 pattern="^[a-zA-Z0-9_]{4,20}$" autocomplete="username" aria-describedby="userIdErr"
                 {# 추가: 값 유지 & 에러시 aria-invalid #}
                 value="{{ form.userId.value|default:'' }}"
                 {% if form.userId.errors %}aria-invalid="true"{% endif %}>
          <div id="userIdErr" class="error">
            {# 추가: 필드 에러 출력 (중복 아이디 메시지가 여기로 옴) #}
            {% for err in form.userId.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 이름 -->
        <div class="form-item">
          <label for="name">이름</label>
          <input id="name" name="name" type="text" placeholder="이름을 입력하세요"
                 required minlength="2" maxlength="10" aria-describedby="nameErr"
                 value="{{ form.name.value|default:'' }}"
                 {% if form.name.errors %}aria-invalid="true"{% endif %}>
          <div id="nameErr" class="error">
            {% for err in form.name.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 비밀번호 -->
        <div class="form-item">
          <label for="password">비밀번호</label>
          <div class="password-wrap">
            <input id="password" name="password" type="password" placeholder="비밀번호를 입력하세요"
                   required pattern="^(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[a-z\d@$!%*?&]{8,}$"
                   aria-describedby="passwordErr" autocomplete="new-password"
                   {% if form.password.errors %}aria-invalid="true"{% endif %}>
            <button class="toggle" type="button" aria-label="비밀번호 표시" aria-pressed="false" data-target="password">
              <svg class="eye-icon eye-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="eye-icon eye-off" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/>
                <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
                <path d="M14.12 14.12a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
          <div id="passwordErr" class="error">
            {% for err in form.password.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 비밀번호 확인 -->
        <div class="form-item">
          <label for="confirmPassword">비밀번호 확인</label>
          <div class="password-wrap">
            <input id="confirmPassword" name="confirmPassword" type="password" placeholder="비밀번호를 다시 입력하세요"
                   required aria-describedby="confirmErr" autocomplete="new-password"
                   {% if form.confirmPassword.errors %}aria-invalid="true"{% endif %}>
            <button class="toggle" type="button" aria-label="비밀번호 표시" aria-pressed="false" data-target="confirmPassword">
              <svg class="eye-icon eye-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <svg class="eye-icon eye-off" style="display:none;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/>
                <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
                <path d="M14.12 14.12a3 3 0 1 1-4.24-4.24"/>
                <line x1="1" y1="1" x2="23" y2="23"/>
              </svg>
            </button>
          </div>
          <div id="confirmErr" class="error">
            {% for err in form.confirmPassword.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 직급 -->
        <div class="form-item">
          <label for="role">직급</label>
          <select id="role" name="role" required aria-describedby="roleErr"
                  {% if form.role.errors %}aria-invalid="true"{% endif %}>
            <option value="" {% if not form.role.value %}selected{% endif %} disabled>직급을 선택하세요</option>
            {% for code, label in ranks %}
              <option value="{{ code }}" {% if form.role.value == code %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <div id="roleErr" class="error">
            {% for err in form.role.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 팀 -->
        <div class="form-item">
          <label for="team">팀</label>
          <select id="team" name="team" required aria-describedby="teamErr"
                  {% if form.team.errors %}aria-invalid="true"{% endif %}>
            <option value="" {% if not form.team.value %}selected{% endif %} disabled>팀을 선택하세요</option>
            {% for code, label in departments %}
              <option value="{{ code }}" {% if form.team.value == code %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <div id="teamErr" class="error">
            {% for err in form.team.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 이메일 -->
        <div class="form-item full">
          <label for="email">이메일</label>
          <input id="email" name="email" type="email" placeholder="이메일을 입력하세요"
                 required aria-describedby="emailErr" autocomplete="email"
                 value="{{ form.email.value|default:'' }}"
                 {% if form.email.errors %}aria-invalid="true"{% endif %}>
          <div id="emailErr" class="error">
            {% for err in form.email.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 성별 -->
        <div class="form-item">
          <label for="gender">성별</label>
          <select id="gender" name="gender" required aria-describedby="genderErr"
                  {% if form.gender.errors %}aria-invalid="true"{% endif %}>
            <option value="" {% if not form.gender.value %}selected{% endif %} disabled>성별을 선택하세요</option>
            {% for code, label in genders %}
              <option value="{{ code }}" {% if form.gender.value == code %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <div id="genderErr" class="error">
            {% for err in form.gender.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 생년월일 -->
        <div class="form-item">
          <label for="birthDate">생년월일</label>
          <input id="birthDate" name="birthDate" type="date" required aria-describedby="birthErr" min="1900-01-01"
                 value="{{ form.birthDate.value|default:'' }}"
                 {% if form.birthDate.errors %}aria-invalid="true"{% endif %}>
          <div id="birthErr" class="error">
            {% for err in form.birthDate.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>

        <!-- 전화번호 -->
        <div class="form-item full">
          <label for="phoneNumber">전화번호</label>
          <input id="phoneNumber" name="phoneNumber" type="text" inputmode="numeric"
                 placeholder="010-1234-5678" required pattern="^010-\d{4}-\d{4}$" aria-describedby="phoneErr"
                 value="{{ form.phoneNumber.value|default:'' }}"
                 {% if form.phoneNumber.errors %}aria-invalid="true"{% endif %}>
          <div id="phoneErr" class="error">
            {% for err in form.phoneNumber.errors %}<p>{{ err }}</p>{% endfor %}
          </div>
        </div>
      </div>

      <button type="submit" class="submit">회원가입</button>
    </form>
  </main>

  <script src="{% static 'uauth/js/signup.js' %}"></script>
</body>
</html>
